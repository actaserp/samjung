<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 9999; /* z-indexë¥¼ ë” ë†’ì„ */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
    }

    /* ê³µí†µ Modal ì»¨í…ì¸  ìŠ¤íƒ€ì¼ */
    .modal-content {
        background: white;
        border-radius: 8px;
        margin: 10% auto;
        padding: 20px;
        width: 600px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        position: relative;
        top: 15%;
    }

    .btn-popup-close img {
        float: right;
    }

    #modalGrid {
        height: auto; /* ë†’ì´ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì • */
        max-height: 500px; /* í•„ìš”ì— ë”°ë¼ ìµœëŒ€ ë†’ì´ë¥¼ ì§€ì • */
        overflow-y: auto; /* ìŠ¤í¬ë¡¤ í™œì„±í™” */
    }

    /* ì²´í¬ë°•ìŠ¤ë¥¼ ìˆ˜ì§ ë° ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
    .wj-cell.wj-header .wj-cell-element,
    .wj-cell.wj-header input[type="checkbox"],
    .wj-cell input[type="checkbox"] {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .section-card-wrap {
        display: flex;
        flex-wrap: nowrap;
        overflow-x: auto;
        gap: 10px;
    }

    .fetchCard {
        flex: 0 0 calc(16.66% - 10px); /* ì¹´ë“œ ë„ˆë¹„ë¥¼ ë°˜ì‘í˜•ìœ¼ë¡œ ì¡°ì ˆ */
        padding: 10px;
        box-sizing: border-box;
        width: auto;
    }
</style>
<th:block layout:fragment="content">

  <!--- (ë ˆì´ì•„ì›ƒ) Contents ì˜ì—­ -->
  <!--<div class="layout-contents">
      &lt;!&ndash; Page Title &ndash;&gt;
      <div class="page-title-wrap">
          <div class="left">
              <h2>Dashboard</h2>
              <img src="/images/icon/exclamation/exclamation-circle.svg"
                   class="zoom-img"
                   onclick="openPopup('https://foms.atlassian.net/wiki/external/MDlmNjZmZmQwN2MyNDNjMmI5NGQxOWY1YWVhNmMxNDI')" alt="ë„ì›€ë§">
              &lt;!&ndash;                <a href="#" title="ë¶ë§ˆí¬" class="bookmark toggle">&ndash;&gt;
              &lt;!&ndash;                    ë‚´ë©”ë‰´&ndash;&gt;
              &lt;!&ndash;                </a>&ndash;&gt;
          </div>
          <ul class="page-navi">
              <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
          </ul>
      </div>
      &lt;!&ndash; Select &ndash;&gt;

      <div class="tab-wrap">
          <ul class="tab-links">
              <li>
                  <a href="#tab1" title="ì£¼ë¬¸ ìº˜ë¦°ë”" class="tab-button">ì£¼ë¬¸ ìº˜ë¦°ë”</a>
              </li>
          </ul>
          <div class="tab-contents">
              &lt;!&ndash; Section &ndash;&gt;
              <section class="tab-item" id="tab1" style="height: 900px; margin-bottom: 10px">
                  <div class="row" style="display: flex;">
                      &lt;!&ndash; ì™¼ìª½ ì„¹ì…˜: 50% ì°¨ì§€ &ndash;&gt;
                      <section
                              style="width: 60%; box-sizing: border-box; height: 830px; margin-right: 20px; border-radius: 10px; ">
                          <div class="title-wrap">
                              <h3>ì£¼ë¬¸ ìº˜ë¦°ë”</h3>
                              <div class="btn-wrap">
                              </div>
                          </div>
                          <div class="calendar-wrap">
                              <div id="calendar"></div>
                          </div>
                      </section>
                      &lt;!&ndash; ì˜¤ë¥¸ìª½ ì„¹ì…˜ì„ ê°ì‹¸ëŠ” div &ndash;&gt;
                      <div style="display: flex; flex-direction: column; width: 40%;">
                          &lt;!&ndash; ìœ„ìª½ ì„¹ì…˜ &ndash;&gt;
                          <section style=" box-sizing: border-box;">
                              <div style="margin-bottom: 15px">
                                  <h3 id="year-status"></h3>
                              </div>
                              <div class="tab-contents">
                                  <div class="row">
                                      <div class="section-card-wrap" style="gap: 5px">
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="0">
                                              <div class="title">
                                                  <h3>ì£¼ë¬¸ì˜ë¢°</h3>
                                              </div>
                                              <div class="requestCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="1">
                                              <div class="title">
                                                  <h3>ì£¼ë¬¸í™•ì¸</h3>
                                              </div>
                                              <div class="checkCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="2">
                                              <div class="title">
                                                  <h3>ì£¼ë¬¸í™•ì •</h3>
                                              </div>
                                              <div class="estimateCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="3">
                                              <div class="title">
                                                  <h3>ì œì‘ì§„í–‰</h3>
                                              </div>
                                              <div class="produceCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="4">
                                              <div class="title">
                                                  <h3>ì¶œê³ </h3>
                                              </div>
                                              <div class="deliveryCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                          <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="5">
                                              <div class="title">
                                                  <h3>ì£¼ë¬¸ì·¨ì†Œ</h3>
                                              </div>
                                              <div class="cancelCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                  -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                                              </div>
                                          </section>
                                      </div> &lt;!&ndash;//main-card-wrap end &ndash;&gt;
                                  </div>
                              </div>
                          </section>

                          &lt;!&ndash; ì•„ë˜ìª½ ì„¹ì…˜ (ë„“ê²Œ ì„¤ì •) &ndash;&gt;
                          <section style="flex: 1; box-sizing: border-box; margin-top: 20px;">
                              <div class="tab-item-sub" id="tab1_2">
                                  <div class="section-top" style="margin-top: 10px;">
                                      <div class="search-wrap">
                                          <dl>
                                              <dt>
                                                  ì¡°íšŒì¼ì<span class="eq">*</span>
                                              </dt>
                                              <dd>
                                                  <ul class="date-box">
                                                      <li>
                                                          <input type="date" id="startDate" name="startDate"
                                                                 value="">
                                                          <label for="startDate" class="hide">ì‹œì‘ì¼</label>
                                                      </li>
                                                      <li>
                                                          <input type="date" id="endDate" name="endDate" value="">
                                                          <label for="endDate" class="hide">ì¢…ë£Œì¼</label>
                                                      </li>
                                                      <li>
                                                          <a class="btn btn-delete" title="ê²€ìƒ‰" id="btn-srch" onclick="fetchListData()">
                                                              <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜">
                                                              ê²€ìƒ‰
                                                          </a>
                                                      </li>
                                                  </ul>
                                              </dd>
                                          </dl>
                                      </div>
                                  </div> &lt;!&ndash;//section-top end &ndash;&gt;
                                  <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                                      &lt;!&ndash; ê·¸ë¦¬ë“œ ì˜ì—­ &ndash;&gt;
                                      <div class="col-12" style="margin-bottom: 10px;">
                                          <div id="theGrid" style="width: 100%; height: 400px;"></div>
                                      </div>
                                  </div>

                              </div>
                          </section>
                      </div>
                  </div>
              </section>
          </div>
      </div>
      </section>
  </div>-->
  <div class="layout-contents">
    <!-- Page Title -->
    <div class="page-title-wrap">
      <div class="left">
        <h2>ì£¼ë¬¸ í˜„í™©</h2>
        <!-- <a id="toggleButton" onclick="toggleSearchWrap()"><img src="/images/icon/ico-down.png" alt="ì•ŒëŒ ì•„ì´ì½˜"></a> -->
        <!--                <a href="#" title="ë¶ë§ˆí¬" class="bookmark toggle">-->
        <!--                    ë‚´ë©”ë‰´-->
        <!--                </a>-->
      </div>
      <ul class="page-navi">
        <li><img src="/images/icon/ico-nav-home.svg" alt="í™ˆì•„ì´ì½˜"></li>
        <li>ì£¼ë¬¸ í˜„í™©</li>
      </ul>
    </div>
    <!-- Select -->
    <div class="search-wrap" id="searchWrap" style="display: none; padding-top:10px">
      <ul>
        <li>
          <select title="ì‚¬ì—…ì¥ì½”ë“œ" id="search_spjangcd" name="search_sjangcd"
                  onchange="init()">
            <option value="" hidden selected disabled>ì„ íƒ</option>
            <option value="ZZ">ì œì´ì•¤ì œì´ì†”ë£¨ì…˜</option>
            <!-- ì§€ì—­ ì˜µì…˜ì„ JavaScriptì—ì„œ ë™ì ìœ¼ë¡œ ì±„ì›€ -->
          </select>
        </li>
      </ul>
    </div>
    <div class="tab-wrap">
      <ul class="tab-links">
        <li>
          <a href="#tab1" title="ì£¼ë¬¸ ìº˜ë¦°ë”" class="tab-button">ì£¼ë¬¸ í˜„í™©</a>
        </li>
      </ul>
      <div class="tab-contents">
        <!-- Section -->
        <section class="tab-item" id="tab1" style="height: 880px; margin-bottom: 10px;">
          <div class="row" style="display: flex; gap: 20px; width: 100%;">

            <!-- ì™¼ìª½: ìº˜ë¦°ë” (60%) -->
            <section style="flex: 6; height: 800px; box-sizing: border-box; border-radius: 10px;">
              <div class="title-wrap">
                <h3>ì£¼ë¬¸ í˜„í™©</h3>
              </div>
              <div class="calendar-wrapper">
                <div id="calendar"></div>
              </div>
            </section>

            <!-- ì˜¤ë¥¸ìª½: í˜„í™© ì¹´ë“œ ë° ê·¸ë¦¬ë“œ (40%) -->
            <div style="flex: 4; display: grid; flex-direction: column;">

              <!-- ìƒë‹¨ ì¹´ë“œ ì„¹ì…˜ -->
              <section style="box-sizing: border-box;">
                <div style="margin-bottom: 15px">
                  <h3 id="year-status">2024ë…„ ì£¼ë¬¸ í˜„í™©</h3>
                </div>
                <div class="tab-contents">
                  <div class="row">
                    <div class="section-card-wrap"
                         style="display: flex; align-items: stretch; flex-wrap: nowrap; gap: 5px;">

                      <section class="fetchCard" data-search-type="5"
                               style="background-color: gray; color: #fff; flex: 0.5; padding: 5px 5px; cursor: pointer;">
                        <div class="title"><h3>ì£¼ë¬¸ì·¨ì†Œ</h3></div>
                        <div class="cancelCnt"
                             style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                      <section class="fetchCard" data-search-type="0"
                               style="background-color: #031B4B; color: #fff; flex: 0.5; padding: 5px; cursor: pointer;">
                        <div class="title"><h3>ì£¼ë¬¸ë“±ë¡</h3></div>
                        <div class="requestCnt" style="font-size: 32px; text-align: right;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                      <section class="fetchCard" data-search-type="1"
                               style="background-color: #03428E; color: #fff; flex: 0.5; padding: 5px; cursor: pointer;">
                        <div class="title"><h3>ì£¼ë¬¸í™•ì¸</h3></div>
                        <div class="checkCnt" style="font-size: 32px; text-align: right;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                      <section class="fetchCard" data-search-type="2"
                               style="background-color: #3069B3; color: #fff; flex: 0.5; padding: 5px; cursor: pointer;">
                        <div class="title"><h3>ì£¼ë¬¸í™•ì •</h3></div>
                        <div class="estimateCnt" style="font-size: 32px; text-align: right;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                      <section class="fetchCard" data-search-type="3"
                               style="background-color: #C7DFF4; color: #031B4B; flex: 0.5; padding: 5px; cursor: pointer;">
                        <div class="title"><h3>ì œì‘ì§„í–‰</h3></div>
                        <div class="produceCnt" style="font-size: 32px; text-align: right;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                      <section class="fetchCard" data-search-type="4"
                               style="background-color: #fff; color: #000; flex: 0.5; padding: 5px; cursor: pointer;">
                        <div class="title"><h3>ì¶œê³ </h3></div>
                        <div class="deliveryCnt" style="font-size: 32px; text-align: right;">
                          -<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>
                        </div>
                      </section>

                    </div>
                  </div>

                </div>
              </section>

              <!-- í•˜ë‹¨ ê·¸ë¦¬ë“œ ì„¹ì…˜ -->
              <section style="flex: 1; box-sizing: border-box; margin-top: 20px;">
                <div class="tab-item-sub" id="tab1_2">
                  <div class="section-top">
                    <div class="search-wrap">
                      <dl>
                        <dt>ì¡°íšŒì¼ì<span class="eq">*</span></dt>
                        <dd>
                          <ul class="date-box">
                            <li><input type="date" id="startDate2" name="startDate"></li>
                            <li><input type="date" id="endDate2" name="endDate"></li>
                            <li>
                              <a class="btn btn-delete" id="btn-srch" onclick="fetchListData();initDatas();">
                                <img src="/images/icon/btn-srch.svg" alt="ê²€ìƒ‰ ì•„ì´ì½˜"> ê²€ìƒ‰
                              </a>
                            </li>
                          </ul>
                        </dd>
                      </dl>
                    </div>
                  </div>
                  <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                    <div class="col-12" style="margin-bottom: 10px;">
                      <div id="theGrid" style="width: 100%; height: 400px;"></div>
                    </div>
                  </div>
                </div>
              </section>

            </div>
          </div>
        </section>
      </div>
    </div>
    </section>
  </div> <!--//tab-contens end-->
  </div> <!--//tab-wrap end-->
  </div> <!--//layout-contents end -->
  <footer style="margin-top:5px;">
    <p>Copyrightâ“’ 0000 corp. All rights reserved.</p>
  </footer>
  <div style="height: 10px"></div>
</th:block>

<th:block layout:fragment="scripts">
  <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
  <script type="text/javascript">
    let theGrid;
    var viewdata;
    let calendar; // ì „ì—­ìœ¼ë¡œ calendar ë³€ìˆ˜ ì„ ì–¸

    // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
    const date = new Date();
    date.setHours(date.getHours() + 9); // UTC+9ë¡œ í•œêµ­ ì‹œê°„ ì„¤ì •
    const today = date.toISOString().split('T')[0];
    // í˜„ì¬ ë…„ë„ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
    const currentYear = new Date().getFullYear();
    const currentMonth = (date.getMonth() + 1).toString().padStart(2, '0'); // 1ì›”ì€ 0ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ +1 ì²˜ë¦¬
    // ì‹œì‘ì¼ inputì— ì˜¬í•´ 1ì›” 1ì¼ì„ ì„¤ì •í•©ë‹ˆë‹¤
    document.readyState === 'complete' ? init() : window.onload = init;

    // ì´ˆë°˜ í˜ì´ì§€ ì§„ì…ì‹œ ê·¸ë¦¬ë“œ ë°”ì¸ë”© ì‹œì‘
    function init() {
      fetchListData();
      initCalendar();
      initDatas();
    }

    // '.fetchCard' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ìš”ì†Œì— ëŒ€í•´ í´ë¦­ ì´ë²¤íŠ¸ ì„¤ì •
    $('.fetchCard').click(function () {
      // í´ë¦­ëœ ì¹´ë“œì˜ data-search-type ì†ì„± ê°’ ê°€ì ¸ì˜¤ê¸°
      const searchTypeValue = $(this).data('search-type');
      fetchListData(searchTypeValue);  // í•´ë‹¹ ê°’ì„ fetchListData í•¨ìˆ˜ë¡œ ì „ë‹¬
    });

    function fetchListData(searchTypeValue) {
      let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
      let emptyRowsCount = 10;
      $.ajax({
        url: '/api/orderDashboard/read',
        type: 'GET',
        data: {
          'search_startDate': $('#startDate').val(),
          'search_endDate': $('#endDate').val(),
          'search_type': searchTypeValue
        },
        async: false,
        success: function (data) {
          data2 = data.data;
          console.log("data2", data2)
          data2.forEach(item => {
            // item.ordflag = getHgrb(item.ordflag);
            // item.reqdate = getListCgrb2(item.reqdate);
            // item.remark = getListCgrb2(item.remark);
            // item.deldate = getListCgrb2(item.deldate);
            // item.amount = getListCgrb2(item.amount);
          })
        }
      })
      viewdata = new wijmo.collections.CollectionView(data2);
      if (!theGrid) {
        theGrid = new wijmo.grid.FlexGrid('#theGrid', {
          autoGenerateColumns: false,
          showMarquee: true,
          isReadOnly: true,
          selectionMode: wijmo.grid.SelectionMode.Row,
          columns: [
            {binding: 'ordflag', header: 'ì§„í–‰êµ¬ë¶„', align: 'center', width: 100},
            {binding: 'reqdate', header: 'ì˜ë¢°ì¼ì', align: 'center', width: 120},
            {binding: 'remark', header: 'ì œëª©', align: 'left', width: 160},
            {binding: 'deldate', header: 'ë‚©í’ˆí¬ë§ì¼', align: 'center', width: 110},
            {binding: 'amount', header: 'ê¸ˆì•¡', align: 'center', width: 200}
          ],
          itemsSource: viewdata // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
        });
        // í—¤ë”ë¥¼ ì¤‘ì•™ ì •ë ¬í•˜ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        theGrid.formatItem.addHandler(function (s, e) {
          if (e.panel === s.columnHeaders) {
            e.cell.style.textAlign = 'center';
          }
        });
        attachDoubleClickEvent(theGrid);   //ë”ë¸”í´ë¦­ ì´ë²¤íŠ¸
        // ì„ íƒì´ ë³€ê²½ë  ë•Œ, í˜„ì¬ í•­ëª© ì—…ë°ì´íŠ¸
        theGrid.rowHeaders.columns.splice(0, 1);
        new FlexGridContextMenu(theGrid);
        window.downloadFileName = 'Order Dashboard';
      } else {
        // ì´ë¯¸ FlexGridì´ ì¡´ì¬í•˜ëŠ” ê²½ìš°, ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸
        theGrid.itemsSource = viewdata; // ë¹ˆ ê°ì²´ê°€ ì¶”ê°€ëœ ë°°ì—´ ì‚¬ìš©
      }
    }

    function initCalendar() {
      var calendarEl = document.getElementById('calendar');
      if (calendarEl) {
        // FullCalendar ì„¤ì •
        calendar = new FullCalendar.Calendar(calendarEl, {
          locale: 'ko',
          headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth'
          },
          initialView: 'dayGridMonth',
          height: 714,
          dayHeaderFormat: {weekday: 'short'},
          views: {
            dayGridMonth: {
              dayCellContent: function (arg) {
                return arg.dayNumberText.replace('ì¼', '');
              }
            }
          },
          dateClick: function (info) {
            console.log('Clicked on: ' + info.dateStr);
            document.getElementById("startDate").value = info.dateStr;
            document.getElementById("endDate").value = info.dateStr;
            fetchListData();
          },
          events: [] // ê¸°ë³¸ ì´ë²¤íŠ¸ëŠ” ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
        });

        // ê³µíœ´ì¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetchHolidays().then(holidays => {
          console.log("holidays : ", holidays)
          holidays.forEach(holiday => {
            calendar.addEvent({
              title: holiday.name, // ê³µíœ´ì¼ ì´ë¦„
              start: holiday.date,  // ê³µíœ´ì¼ ë‚ ì§œ
              backgroundColor: '#ec193a',
              borderColor: '#EC193A',
              textColor: 'white'
            });
          });
          setTimeout(() => {
            calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
            console.log('ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.');
          }, 500); // 500ms ë”œë ˆì´
        }).catch(error => {
          console.error('ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
        });

        // ì£¼ë¬¸í˜„í™© ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        // ì£¼ë¬¸í˜„í™© ë°ì´í„° ê°€ì ¸ì™€ì„œ ë‚ ì§œë³„ ê·¸ë£¹í™” í›„ ìº˜ë¦°ë”ì— ì¶”ê°€
        fetchOrderDates().then(orderDates => {
          //console.log("ğŸ“¢ ì›ë³¸ orderDates ë°ì´í„°:", orderDates);

          // 1ï¸âƒ£ ë‚ ì§œë³„ ê·¸ë£¹í™” ( { "YYYY-MM-DD": { "ì£¼ë¬¸í™•ì¸": 3, "ì¶œê³ ": 2 } } í˜•íƒœë¡œ ì €ì¥ )
          let groupedEvents = {};

          orderDates.forEach(order => {
            let date = order.date;  // ì£¼ë¬¸ ë‚ ì§œ
            let name = order.name;  // ì£¼ë¬¸ ìƒíƒœ (ì£¼ë¬¸ë“±ë¡, ì£¼ë¬¸í™•ì¸ ë“±)

            // í•´ë‹¹ ë‚ ì§œê°€ ì´ë¯¸ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
            if (!groupedEvents[date]) {
              groupedEvents[date] = {};
            }

            // í•´ë‹¹ ìƒíƒœê°€ ì´ë¯¸ ì¡´ì¬í•˜ë©´ count ì¦ê°€
            if (groupedEvents[date][name]) {
              groupedEvents[date][name]++;
            } else {
              groupedEvents[date][name] = 1;
            }
          });

          // console.log("ğŸ“¢ ë‚ ì§œë³„ ê·¸ë£¹í™”ëœ ë°ì´í„°:", groupedEvents);

          // 2ï¸âƒ£ FullCalendar ì´ë²¤íŠ¸ ì¶”ê°€ (ì¤‘ë³µ ì œê±° í›„ ê°œìˆ˜ í‘œì‹œ)
          Object.keys(groupedEvents).forEach(date => {
            Object.keys(groupedEvents[date]).forEach(name => {
              let count = groupedEvents[date][name]; // ì£¼ë¬¸ ê°œìˆ˜
              let displayTitle = count > 1 ? `${name} (${count})` : name; // ê°œìˆ˜ í‘œì‹œ

              let eventColor = getEventColor(name); // ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°

              calendar.addEvent({
                title: displayTitle,
                start: date,
                backgroundColor: eventColor.bg,
                borderColor: eventColor.border,
                textColor: eventColor.text
              });
            });
          });

          setTimeout(() => {
            calendar.render(); // ìº˜ë¦°ë” ë Œë”ë§
            // console.log("ğŸ“¢ ìº˜ë¦°ë”ê°€ ë Œë”ë§ë˜ì—ˆìŠµë‹ˆë‹¤.");
          }, 500);
        }).catch(error => {
          console.error("âŒ ì£¼ë¬¸í˜„í™© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
        });
      }
    }

    // ê³µíœ´ì¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchHolidays() {
      const currentYear = new Date().getFullYear();
      const yearsToFetch = [currentYear - 1, currentYear, currentYear + 1]; // ì „ë…„ë„, í˜„ì¬ ì—°ë„, ë‹¤ìŒ ì—°ë„ ë°°ì—´ ìƒì„±

      const holidays = [];

      for (const year of yearsToFetch) {
        const yearHolidays = await fetchHolidaysForYear(year);
        holidays.push(...yearHolidays);
      }
      console.log("holidays : ", holidays)
      return holidays;
    }

    // ì£¼ë¬¸í˜„í™© ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchOrderDates() {
      let data2 = []; // ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´
      let emptyRowsCount = 8;
      var orderDates = [];
      $.ajax({
        url: '/api/orderDashboard/readCalenderGrid',
        type: 'GET',
        data: {},
        async: false,
        success: function (response) {
          // ì‘ë‹µì´ ì˜¬ë°”ë¥´ê²Œ ë„ì°©í–ˆê³ , data ì†ì„±ì´ ë°°ì—´ì¸ì§€ í™•ì¸
          if (response && Array.isArray(response.data)) {
            data2 = response.data;
            // ë‚ ì§œ í˜•ì‹ ë³€í™˜ ë° ordflag ë³€í™˜
            //console.log("ìº˜ë¦°ë” ë°ì´í„° : ", data2);
          }
        },
        error: function () {
          console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      });

      // viewdata.itemsë¥¼ ë°˜ë³µí•˜ì—¬ ê° í•­ëª©ì˜ ordflagì™€ reqdate ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      for (var i = 0; i < data2.length; i++) {
        var item = data2[i];
        orderDates.push({
          name: item.ordflag,
          date: item.reqdate
        });
      }
      //console.log("orderDates : ", orderDates)
      return orderDates;
    }

    // ì£¼ë¬¸ ìƒíƒœì— ë”°ë¥¸ ìƒ‰ìƒ ì„¤ì •
    function getEventColor(name) {
      switch (name) {
        case "ì£¼ë¬¸ë“±ë¡":
          return {bg: "#031B4B", border: "#031B4B", text: "white"};
        case "ì£¼ë¬¸í™•ì¸":
          return {bg: "#03428E", border: "#03428E", text: "white"};
        case "ì£¼ë¬¸í™•ì •":
          return {bg: "#3069B3", border: "#3069B3", text: "white"};
        case "ì œì‘ì§„í–‰":
          return {bg: "#C7DFF4", border: "rgba(2,165,255,0.07)", text: "black"};
        case "ì¶œê³ ":
          return {bg: "white", border: "grey", text: "black"};
        case "ì£¼ë¬¸ì·¨ì†Œ":
          return {bg: "grey", border: "grey", text: "black"};
        default:
          return {bg: "grey", border: "grey", text: "white"};
      }
    }

    async function fetchHolidaysForYear(year) {
      return new Promise((resolve, reject) => {
        var xhr = new XMLHttpRequest();
        var url = 'http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo';
        var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + 'R3P3syhq6qRP0cz8mbV2J5t%2B32WwaSN9sH8ZW4k59oKAU3Ze0WvcljMrN36OJqxs38%2F780hMD4QfhCiDZQNUyA%3D%3D';
        queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent(year);
        queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30');

        xhr.open('GET', url + queryParams);
        xhr.onreadystatechange = function () {
          if (this.readyState == 4) {
            if (this.status == 200) {
              var parser = new DOMParser();
              var xmlDoc = parser.parseFromString(this.responseText, "text/xml");

              // XMLì—ì„œ ì›í•˜ëŠ” ë°ì´í„° ì¶”ì¶œ
              var items = xmlDoc.getElementsByTagName("item");
              let holidays = [];
              for (var i = 0; i < items.length; i++) {
                var locdate = items[i].getElementsByTagName("locdate")[0].textContent;
                var dateName = items[i].getElementsByTagName("dateName")[0].textContent;

                holidays.push({date: locdate, name: dateName});
              }
              resolve(holidays);
            } else {
              console.error('ì˜¤ë¥˜ ë°œìƒ. HTTP ìƒíƒœ ì½”ë“œ:', this.status);
              reject(this.status);
            }
          }
        };

        xhr.send();
      });
    }

    function initDatas() {
      $.ajax({
        url: '/api/orderDashboard/initDatas',
        type: 'GET',
        data: {},
        async: false,
        success: function (data) {
          data2 = data.data;
          data2.forEach(item => {
            switch (item.ordflag) {
              case "0":
                $('.requestCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              case "1":
                $('.checkCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              case "2":
                $('.estimateCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              case "3":
                $('.produceCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              case "4":
                $('.deliveryCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              case "5":
                $('.cancelCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> ê±´</span>');
                break;
              default:
                console.log("ì£¼ë¬¸í˜„í™© ë°”ì¸ë“œ ì˜¤ë¥˜ : ", item.ordflag);
            }
          })
        }
      })
    }

    // ê°€ì´ë“œ web íŒì—…ì°½ ì—´ê¸°
    function openPopup(url) {
      // ìƒˆ ì°½ ì—´ê¸°
      window.open(url, '_blank',
        'width=1040,height=1000,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
    }

    // âœ… ë”ë¸” í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ìˆ˜ì •
    function attachDoubleClickEvent(grid) {
      let lastClickTime = 0;

      grid.hostElement.addEventListener('click', function (e) {
        const now = new Date().getTime();

        if (now - lastClickTime < 300) { // 300ms ì´ë‚´ ë‘ ë²ˆ í´ë¦­ â†’ ë”ë¸” í´ë¦­ ì²˜ë¦¬
          const ht = grid.hitTest(e);

          if (ht.cellType === wijmo.grid.CellType.Cell) { // ì…€ì„ í´ë¦­í•œ ê²½ìš°ë§Œ ì²˜ë¦¬
            const rowData = grid.rows[ht.row].dataItem; // í´ë¦­í•œ í–‰ ë°ì´í„°

            if (!rowData || !rowData.reqnum) {
              console.warn("âŒ ìœ íš¨í•œ rowData ë˜ëŠ” reqnumì´ ì—†ìŠµë‹ˆë‹¤.");
              return;
            }
            //sessionStorage ì— ì €ì¥
            sessionStorage.setItem("tabAction", "toggle");
            sessionStorage.setItem("sessionDate", rowData.reqdate);
            window.parent.postMessage({
              action: "addTab",
              id: "order_request",
              title: "ì£¼ë¬¸ë“±ë¡",
              url: '/gui/' + "order_request" + '/default',
              active: true,
              allowClose: true,
            });
          }
        }
        lastClickTime = now;
      });
    }
  </script>
</th:block>
</html>

