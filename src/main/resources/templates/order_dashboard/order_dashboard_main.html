<html layout:decorate="~{layout_page}" xmlns:layout="http://www.w3.org/1999/xhtml">
<style>

</style>
<th:block layout:fragment="content">

    <!--- (Î†àÏù¥ÏïÑÏõÉ) Contents ÏòÅÏó≠ -->
    <div class="layout-contents">
        <!-- Page Title -->
        <div class="page-title-wrap">
            <div class="left">
                <h2>Dashboard</h2>
                <img src="/images/icon/exclamation/exclamation-circle.svg"
                     class="zoom-img"
                     onclick="openPopup('https://foms.atlassian.net/wiki/external/MDlmNjZmZmQwN2MyNDNjMmI5NGQxOWY1YWVhNmMxNDI')" alt="ÎèÑÏõÄÎßê">
                <!--                <a href="#" title="Î∂ÅÎßàÌÅ¨" class="bookmark toggle">-->
                <!--                    ÎÇ¥Î©îÎâ¥-->
                <!--                </a>-->
            </div>
            <ul class="page-navi">
                <li><img src="/images/icon/ico-nav-home.svg" alt="ÌôàÏïÑÏù¥ÏΩò"></li>
            </ul>
        </div>
        <!-- Select -->

        <div class="tab-wrap">
            <ul class="tab-links">
                <li>
                    <a href="#tab1" title="Ï£ºÎ¨∏ Ï∫òÎ¶∞Îçî" class="tab-button">Ï£ºÎ¨∏ Ï∫òÎ¶∞Îçî</a>
                </li>
            </ul>
            <div class="tab-contents">
                <!-- Section -->
                <section class="tab-item" id="tab1" style="height: 900px; margin-bottom: 10px">
                    <div class="row" style="display: flex;">
                        <!-- ÏôºÏ™Ω ÏÑπÏÖò: 50% Ï∞®ÏßÄ -->
                        <section
                                style="width: 60%; box-sizing: border-box; height: 830px; margin-right: 20px; border-radius: 10px; ">
                            <div class="title-wrap">
                                <h3>Ï£ºÎ¨∏ Ï∫òÎ¶∞Îçî</h3>
                                <div class="btn-wrap">
                                </div>
                            </div>
                            <div class="calendar-wrap">
                                <div id="calendar"></div>
                            </div>
                        </section>
                        <!-- Ïò§Î•∏Ï™Ω ÏÑπÏÖòÏùÑ Í∞êÏã∏Îäî div -->
                        <div style="display: flex; flex-direction: column; width: 40%;">
                            <!-- ÏúÑÏ™Ω ÏÑπÏÖò -->
                            <section style=" box-sizing: border-box;">
                                <div style="margin-bottom: 15px">
                                    <h3 id="year-status"></h3>
                                </div>
                                <div class="tab-contents">
                                    <div class="row">
                                        <div class="section-card-wrap" style="gap: 5px">
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="0">
                                                <div class="title">
                                                    <h3>Ï£ºÎ¨∏ÏùòÎ¢∞</h3>
                                                </div>
                                                <div class="requestCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="1">
                                                <div class="title">
                                                    <h3>Ï£ºÎ¨∏ÌôïÏù∏</h3>
                                                </div>
                                                <div class="checkCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="2">
                                                <div class="title">
                                                    <h3>Ï£ºÎ¨∏ÌôïÏ†ï</h3>
                                                </div>
                                                <div class="estimateCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="3">
                                                <div class="title">
                                                    <h3>Ï†úÏûëÏßÑÌñâ</h3>
                                                </div>
                                                <div class="produceCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="4">
                                                <div class="title">
                                                    <h3>Ï∂úÍ≥†</h3>
                                                </div>
                                                <div class="deliveryCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                            <section style="flex: 0.5; margin-right: 5px; cursor: pointer; padding: 10px 10px;" class="fetchCard" data-search-type="5">
                                                <div class="title">
                                                    <h3>Ï£ºÎ¨∏Ï∑®ÏÜå</h3>
                                                </div>
                                                <div class="cancelCnt" style="font-size: 32px; font-weight: 700; text-align: right; margin: 9px 0;">
                                                    -<span class="small-unit" style=" font-size: 0.5em; opacity: 0.5;"> Í±¥</span>
                                                </div>
                                            </section>
                                        </div> <!--//main-card-wrap end -->
                                    </div>
                                </div>
                            </section>

                            <!-- ÏïÑÎûòÏ™Ω ÏÑπÏÖò (ÎÑìÍ≤å ÏÑ§Ï†ï) -->
                            <section style="flex: 1; box-sizing: border-box; margin-top: 20px;">
                                <div class="tab-item-sub" id="tab1_2">
                                    <div class="section-top" style="margin-top: 10px;">
                                        <div class="search-wrap">
                                            <dl>
                                                <dt>
                                                    Ï°∞ÌöåÏùºÏûê<span class="eq">*</span>
                                                </dt>
                                                <dd>
                                                    <ul class="date-box">
                                                        <li>
                                                            <input type="date" id="startDate" name="startDate"
                                                                   value="">
                                                            <label for="startDate" class="hide">ÏãúÏûëÏùº</label>
                                                        </li>
                                                        <li>
                                                            <input type="date" id="endDate" name="endDate" value="">
                                                            <label for="endDate" class="hide">Ï¢ÖÎ£åÏùº</label>
                                                        </li>
                                                        <li>
                                                            <a class="btn btn-delete" title="Í≤ÄÏÉâ" id="btn-srch" onclick="fetchListData()">
                                                                <img src="/images/icon/btn-srch.svg" alt="Í≤ÄÏÉâ ÏïÑÏù¥ÏΩò">
                                                                Í≤ÄÏÉâ
                                                            </a>
                                                        </li>
                                                    </ul>
                                                </dd>
                                            </dl>
                                        </div>
                                    </div> <!--//section-top end -->
                                    <div class="container-fluid" style="padding-left: 0; padding-right: 0;">
                                        <!-- Í∑∏Î¶¨Îìú ÏòÅÏó≠ -->
                                        <div class="col-12" style="margin-bottom: 10px;">
                                            <div id="theGrid" style="width: 100%; height: 400px;"></div>
                                        </div>
                                    </div>

                                </div>
                            </section>
                        </div>
                    </div>
                </section>
            </div>
        </div>
        </section>
    </div> <!--//tab-contens end-->
    </div> <!--//tab-wrap end-->
    </div> <!--//layout-contents end -->
    <footer style="margin-top:5px;">
        <p>Copyright‚ìí 0000 corp. All rights reserved.</p>
    </footer>
    <div style="height: 10px"></div>
</th:block>

<th:block layout:fragment="scripts">
    <th:block th:replace="/common/columns_setting :: columns_setting"></th:block>
    <script type="text/javascript">
        let theGrid;
        var viewdata;
        let calendar; // Ï†ÑÏó≠ÏúºÎ°ú calendar Î≥ÄÏàò ÏÑ†Ïñ∏

        // Ïò§Îäò ÎÇ†Ïßú ÏÑ§Ï†ï
        const date = new Date();
        date.setHours(date.getHours() + 9); // UTC+9Î°ú ÌïúÍµ≠ ÏãúÍ∞Ñ ÏÑ§Ï†ï
        const today = date.toISOString().split('T')[0];
        // ÌòÑÏû¨ ÎÖÑÎèÑÎ•º Í∞ÄÏ†∏ÏòµÎãàÎã§
        const currentYear = new Date().getFullYear();
        const currentMonth = (date.getMonth() + 1).toString().padStart(2, '0'); // 1ÏõîÏùÄ 0Î∂ÄÌÑ∞ ÏãúÏûëÌïòÎØÄÎ°ú +1 Ï≤òÎ¶¨
        // ÏãúÏûëÏùº inputÏóê Ïò¨Ìï¥ 1Ïõî 1ÏùºÏùÑ ÏÑ§Ï†ïÌï©ÎãàÎã§
        document.getElementById('startDate').value = `${currentYear}-${currentMonth}-01`;
        document.getElementById('endDate').value = today;
        document.getElementById('year-status').innerText = `${currentYear}ÎÖÑ Ï£ºÎ¨∏ ÌòÑÌô©`;

        document.readyState === 'complete' ? init() : window.onload = init;

        // Ï¥àÎ∞ò ÌéòÏù¥ÏßÄ ÏßÑÏûÖÏãú Í∑∏Î¶¨Îìú Î∞îÏù∏Îî© ÏãúÏûë
        function init() {
            fetchListData();
            initCalendar();
            initDatas();
        }
        // '.fetchCard' ÌÅ¥ÎûòÏä§Î•º Í∞ÄÏßÑ Î™®Îì† ÏöîÏÜåÏóê ÎåÄÌï¥ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ ÏÑ§Ï†ï
        $('.fetchCard').click(function() {
            // ÌÅ¥Î¶≠Îêú Ïπ¥ÎìúÏùò data-search-type ÏÜçÏÑ± Í∞í Í∞ÄÏ†∏Ïò§Í∏∞
            const searchTypeValue = $(this).data('search-type');
            fetchListData(searchTypeValue);  // Ìï¥Îãπ Í∞íÏùÑ fetchListData Ìï®ÏàòÎ°ú Ï†ÑÎã¨
        });
        function fetchListData(searchTypeValue) {
            let data2 = []; // Îç∞Ïù¥ÌÑ∞Î•º Îã¥ÏùÑ Î∞∞Ïó¥
            let emptyRowsCount = 10;
            $.ajax({
                url: '/api/orderDashboard/read',
                type: 'GET',
                data: {
                    'search_startDate': $('#startDate').val(),
                    'search_endDate': $('#endDate').val(),
                    'search_type': searchTypeValue
                },
                async: false,
                success: function (data) {
                    data2 = data.data;
                    console.log("data2",data2)
                    data2.forEach(item =>{
                        // item.ordflag = getHgrb(item.ordflag);
                        // item.reqdate = getListCgrb2(item.reqdate);
                        // item.remark = getListCgrb2(item.remark);
                        // item.deldate = getListCgrb2(item.deldate);
                        // item.amount = getListCgrb2(item.amount);
                    })
                }
            })
            viewdata = new wijmo.collections.CollectionView(data2);
            if (!theGrid) {
                theGrid = new wijmo.grid.FlexGrid('#theGrid', {
                    autoGenerateColumns: false,
                    showMarquee: true,
                    isReadOnly: true,
                    selectionMode: wijmo.grid.SelectionMode.Row,
                    columns: [
                        { binding: 'ordflag', header: 'ÏßÑÌñâÍµ¨Î∂Ñ', align: 'center', width: 100 },
                        { binding: 'reqdate', header: 'ÏùòÎ¢∞ÏùºÏûê', align: 'center', width: 120 },
                        { binding: 'remark', header: 'Ï†úÎ™©', align: 'left', width: 160 },
                        { binding: 'deldate', header: 'ÎÇ©ÌíàÌù¨ÎßùÏùº', align: 'center', width: 110 },
                        { binding: 'amount', header: 'Í∏àÏï°', align: 'center', width: 200 }
                    ],
                    itemsSource: viewdata // Îπà Í∞ùÏ≤¥Í∞Ä Ï∂îÍ∞ÄÎêú Î∞∞Ïó¥ ÏÇ¨Ïö©
                });
                // Ìó§ÎçîÎ•º Ï§ëÏïô Ï†ïÎ†¨ÌïòÎäî Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨
                theGrid.formatItem.addHandler(function (s, e) {
                    if (e.panel === s.columnHeaders) {
                        e.cell.style.textAlign = 'center';
                    }
                });
                attachDoubleClickEvent(theGrid);   //ÎçîÎ∏îÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏
                // ÏÑ†ÌÉùÏù¥ Î≥ÄÍ≤ΩÎê† Îïå, ÌòÑÏû¨ Ìï≠Î™© ÏóÖÎç∞Ïù¥Ìä∏
                theGrid.rowHeaders.columns.splice(0, 1);
                new FlexGridContextMenu(theGrid);
                window.downloadFileName = 'Order Dashboard';
            } else {
                // Ïù¥ÎØ∏ FlexGridÏù¥ Ï°¥Ïû¨ÌïòÎäî Í≤ΩÏö∞, Îç∞Ïù¥ÌÑ∞Îßå ÏóÖÎç∞Ïù¥Ìä∏
                theGrid.itemsSource = viewdata; // Îπà Í∞ùÏ≤¥Í∞Ä Ï∂îÍ∞ÄÎêú Î∞∞Ïó¥ ÏÇ¨Ïö©
            }
        }

        function initCalendar() {
            var calendarEl = document.getElementById('calendar');
            if (calendarEl) {
                // FullCalendar ÏÑ§Ï†ï
                calendar = new FullCalendar.Calendar(calendarEl, {
                    locale: 'ko',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth'
                    },
                    initialView: 'dayGridMonth',
                    height: 714,
                    dayHeaderFormat: { weekday: 'short' },
                    views: {
                        dayGridMonth: {
                            dayCellContent: function (arg) {
                                return arg.dayNumberText.replace('Ïùº', '');
                            }
                        }
                    },
                    dateClick: function (info) {
                        console.log('Clicked on: ' + info.dateStr);
                        document.getElementById("startDate").value = info.dateStr;
                        document.getElementById("endDate").value = info.dateStr;
                        fetchListData();
                    },
                    events: [] // Í∏∞Î≥∏ Ïù¥Î≤§Ìä∏Îäî Îπà Î∞∞Ïó¥Î°ú ÏÑ§Ï†ï
                });

                // Í≥µÌú¥Ïùº Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                fetchHolidays().then(holidays => {
                    console.log("holidays : ", holidays)
                    holidays.forEach(holiday => {
                        calendar.addEvent({
                            title: holiday.name, // Í≥µÌú¥Ïùº Ïù¥Î¶Ñ
                            start: holiday.date,  // Í≥µÌú¥Ïùº ÎÇ†Ïßú
                            backgroundColor: '#ec193a',
                            borderColor: '#EC193A',
                            textColor: 'white'
                        });
                    });
                    setTimeout(() => {
                        calendar.render(); // Ï∫òÎ¶∞Îçî Î†åÎçîÎßÅ
                        console.log('Ï∫òÎ¶∞ÎçîÍ∞Ä Î†åÎçîÎßÅÎêòÏóàÏäµÎãàÎã§.');
                    }, 500); // 500ms ÎîúÎ†àÏù¥
                }).catch(error => {
                    console.error('Í≥µÌú¥Ïùº Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:', error);
                });

                // Ï£ºÎ¨∏ÌòÑÌô© Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                // Ï£ºÎ¨∏ÌòÑÌô© Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏ÏôÄÏÑú ÎÇ†ÏßúÎ≥Ñ Í∑∏Î£πÌôî ÌõÑ Ï∫òÎ¶∞ÎçîÏóê Ï∂îÍ∞Ä
                fetchOrderDates().then(orderDates => {
                    //console.log("üì¢ ÏõêÎ≥∏ orderDates Îç∞Ïù¥ÌÑ∞:", orderDates);

                    // 1Ô∏è‚É£ ÎÇ†ÏßúÎ≥Ñ Í∑∏Î£πÌôî ( { "YYYY-MM-DD": { "Ï£ºÎ¨∏ÌôïÏù∏": 3, "Ï∂úÍ≥†": 2 } } ÌòïÌÉúÎ°ú Ï†ÄÏû• )
                    let groupedEvents = {};

                    orderDates.forEach(order => {
                        let date = order.date;  // Ï£ºÎ¨∏ ÎÇ†Ïßú
                        let name = order.name;  // Ï£ºÎ¨∏ ÏÉÅÌÉú (Ï£ºÎ¨∏Îì±Î°ù, Ï£ºÎ¨∏ÌôïÏù∏ Îì±)

                        // Ìï¥Îãπ ÎÇ†ÏßúÍ∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäîÏßÄ ÌôïÏù∏
                        if (!groupedEvents[date]) {
                            groupedEvents[date] = {};
                        }

                        // Ìï¥Îãπ ÏÉÅÌÉúÍ∞Ä Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎ©¥ count Ï¶ùÍ∞Ä
                        if (groupedEvents[date][name]) {
                            groupedEvents[date][name]++;
                        } else {
                            groupedEvents[date][name] = 1;
                        }
                    });

                    // console.log("üì¢ ÎÇ†ÏßúÎ≥Ñ Í∑∏Î£πÌôîÎêú Îç∞Ïù¥ÌÑ∞:", groupedEvents);

                    // 2Ô∏è‚É£ FullCalendar Ïù¥Î≤§Ìä∏ Ï∂îÍ∞Ä (Ï§ëÎ≥µ Ï†úÍ±∞ ÌõÑ Í∞úÏàò ÌëúÏãú)
                    Object.keys(groupedEvents).forEach(date => {
                        Object.keys(groupedEvents[date]).forEach(name => {
                            let count = groupedEvents[date][name]; // Ï£ºÎ¨∏ Í∞úÏàò
                            let displayTitle = count > 1 ? `${name} (${count})` : name; // Í∞úÏàò ÌëúÏãú

                            let eventColor = getEventColor(name); // ÏÉâÏÉÅ Í∞ÄÏ†∏Ïò§Í∏∞

                            calendar.addEvent({
                                title: displayTitle,
                                start: date,
                                backgroundColor: eventColor.bg,
                                borderColor: eventColor.border,
                                textColor: eventColor.text
                            });
                        });
                    });

                    setTimeout(() => {
                        calendar.render(); // Ï∫òÎ¶∞Îçî Î†åÎçîÎßÅ
                        // console.log("üì¢ Ï∫òÎ¶∞ÎçîÍ∞Ä Î†åÎçîÎßÅÎêòÏóàÏäµÎãàÎã§.");
                    }, 500);
                }).catch(error => {
                    console.error("‚ùå Ï£ºÎ¨∏ÌòÑÌô© Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Îç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:", error);
                });
            }
        }

        // Í≥µÌú¥Ïùº Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
        async function fetchHolidays() {
            const currentYear = new Date().getFullYear();
            const yearsToFetch = [currentYear - 1, currentYear, currentYear + 1]; // Ï†ÑÎÖÑÎèÑ, ÌòÑÏû¨ Ïó∞ÎèÑ, Îã§Ïùå Ïó∞ÎèÑ Î∞∞Ïó¥ ÏÉùÏÑ±

            const holidays = [];

            for (const year of yearsToFetch) {
                const yearHolidays = await fetchHolidaysForYear(year);
                holidays.push(...yearHolidays);
            }
            console.log("holidays : ", holidays)
            return holidays;
        }
        // Ï£ºÎ¨∏ÌòÑÌô© Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ìï®Ïàò
        async function fetchOrderDates() {
            let data2 = []; // Îç∞Ïù¥ÌÑ∞Î•º Îã¥ÏùÑ Î∞∞Ïó¥
            let emptyRowsCount = 8;
            var orderDates = [];
            $.ajax({
                url: '/api/orderDashboard/readCalenderGrid',
                type: 'GET',
                data: {},
                async: false,
                success: function (response) {
                    // ÏùëÎãµÏù¥ Ïò¨Î∞îÎ•¥Í≤å ÎèÑÏ∞©ÌñàÍ≥†, data ÏÜçÏÑ±Ïù¥ Î∞∞Ïó¥Ïù∏ÏßÄ ÌôïÏù∏
                    if (response && Array.isArray(response.data)) {
                        data2 = response.data;
                        // ÎÇ†Ïßú ÌòïÏãù Î≥ÄÌôò Î∞è ordflag Î≥ÄÌôò
                        //console.log("Ï∫òÎ¶∞Îçî Îç∞Ïù¥ÌÑ∞ : ", data2);
                    }
                },
                error: function () {
                    console.error("Îç∞Ïù¥ÌÑ∞Î•º Í∞ÄÏ†∏Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                }
            });

            // viewdata.itemsÎ•º Î∞òÎ≥µÌïòÏó¨ Í∞Å Ìï≠Î™©Ïùò ordflagÏôÄ reqdate Í∞íÏùÑ Í∞ÄÏ†∏ÏòµÎãàÎã§.
            for (var i = 0; i < data2.length; i++) {
                var item = data2[i];
                orderDates.push({
                    name: item.ordflag,
                    date: item.reqdate
                });
            }
            //console.log("orderDates : ", orderDates)
            return orderDates;
        }

        // Ï£ºÎ¨∏ ÏÉÅÌÉúÏóê Îî∞Î•∏ ÏÉâÏÉÅ ÏÑ§Ï†ï
        function getEventColor(name) {
            switch (name) {
                case "Ï£ºÎ¨∏Îì±Î°ù":
                    return { bg: "#031B4B", border: "#031B4B", text: "white" };
                case "Ï£ºÎ¨∏ÌôïÏù∏":
                    return { bg: "#03428E", border: "#03428E", text: "white" };
                case "Ï£ºÎ¨∏ÌôïÏ†ï":
                    return { bg: "#3069B3", border: "#3069B3", text: "white" };
                case "Ï†úÏûëÏßÑÌñâ":
                    return { bg: "#C7DFF4", border: "rgba(2,165,255,0.07)", text: "black" };
                case "Ï∂úÍ≥†":
                    return { bg: "white", border: "grey", text: "black" };
                case "Ï£ºÎ¨∏Ï∑®ÏÜå":
                    return { bg: "grey", border: "grey", text: "black" };
                default:
                    return { bg: "grey", border: "grey", text: "white" };
            }
        }

        async function fetchHolidaysForYear(year) {
            return new Promise((resolve, reject) => {
                var xhr = new XMLHttpRequest();
                var url = 'http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo';
                var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + 'R3P3syhq6qRP0cz8mbV2J5t%2B32WwaSN9sH8ZW4k59oKAU3Ze0WvcljMrN36OJqxs38%2F780hMD4QfhCiDZQNUyA%3D%3D';
                queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent(year);
                queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30');

                xhr.open('GET', url + queryParams);
                xhr.onreadystatechange = function () {
                    if (this.readyState == 4) {
                        if (this.status == 200) {
                            var parser = new DOMParser();
                            var xmlDoc = parser.parseFromString(this.responseText, "text/xml");

                            // XMLÏóêÏÑú ÏõêÌïòÎäî Îç∞Ïù¥ÌÑ∞ Ï∂îÏ∂ú
                            var items = xmlDoc.getElementsByTagName("item");
                            let holidays = [];
                            for (var i = 0; i < items.length; i++) {
                                var locdate = items[i].getElementsByTagName("locdate")[0].textContent;
                                var dateName = items[i].getElementsByTagName("dateName")[0].textContent;

                                holidays.push({ date: locdate, name: dateName });
                            }
                            resolve(holidays);
                        } else {
                            console.error('Ïò§Î•ò Î∞úÏÉù. HTTP ÏÉÅÌÉú ÏΩîÎìú:', this.status);
                            reject(this.status);
                        }
                    }
                };

                xhr.send();
            });
        }
        function initDatas(){
            $.ajax({
                url: '/api/orderDashboard/initDatas',
                type: 'GET',
                data: {},
                async: false,
                success: function (data) {
                    data2 = data.data;
                    data2.forEach(item =>{
                        switch (item.ordflag) {
                            case "0":
                                $('.requestCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            case "1":
                                $('.checkCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            case "2":
                                $('.estimateCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            case "3":
                                $('.produceCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            case "4":
                                $('.deliveryCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            case "5":
                                $('.cancelCnt').html(item.ordflag_count + '<span class="small-unit" style="font-size: 0.5em; opacity: 0.5;"> Í±¥</span>');
                                break;
                            default:
                                console.log("Ï£ºÎ¨∏ÌòÑÌô© Î∞îÏù∏Îìú Ïò§Î•ò : ", item.ordflag);
                        }
                    })
                }
            })
        }
        // Í∞ÄÏù¥Îìú web ÌåùÏóÖÏ∞Ω Ïó¥Í∏∞
        function openPopup(url) {
            // ÏÉà Ï∞Ω Ïó¥Í∏∞
            window.open(url, '_blank',
                'width=1040,height=1000,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes');
        }

        // ‚úÖ ÎçîÎ∏î ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ ÏàòÏ†ï
        function attachDoubleClickEvent(grid) {
            let lastClickTime = 0;

            grid.hostElement.addEventListener('click', function (e) {
                const now = new Date().getTime();

                if (now - lastClickTime < 300) { // 300ms Ïù¥ÎÇ¥ Îëê Î≤à ÌÅ¥Î¶≠ ‚Üí ÎçîÎ∏î ÌÅ¥Î¶≠ Ï≤òÎ¶¨
                    const ht = grid.hitTest(e);

                    if (ht.cellType === wijmo.grid.CellType.Cell) { // ÏÖÄÏùÑ ÌÅ¥Î¶≠Ìïú Í≤ΩÏö∞Îßå Ï≤òÎ¶¨
                        const rowData = grid.rows[ht.row].dataItem; // ÌÅ¥Î¶≠Ìïú Ìñâ Îç∞Ïù¥ÌÑ∞

                        if (!rowData || !rowData.reqnum) {
                            console.warn("‚ùå Ïú†Ìö®Ìïú rowData ÎòêÎäî reqnumÏù¥ ÏóÜÏäµÎãàÎã§.");
                            return;
                        }
                        //sessionStorage Ïóê Ï†ÄÏû•
                        sessionStorage.setItem("tabAction", "toggle");
                        sessionStorage.setItem("sessionDate", rowData.reqdate);
                        window.parent.postMessage({
                            action: "addTab",
                            id: "order_request",
                            title: "Ï£ºÎ¨∏Îì±Î°ù",
                            url: '/gui/' + "order_request" + '/default',
                            active: true,
                            allowClose: true,
                        });
                    }
                }
                lastClickTime = now;
            });
        }
    </script>
</th:block>
</html>

